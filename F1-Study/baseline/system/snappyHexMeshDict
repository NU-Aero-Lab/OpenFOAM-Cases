/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  4.x                                   |
|   \\  /    A nd           | Web:      www.OpenFOAM.org                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

castellatedMesh true;
snap            true;
addLayers       true;

geometry
{
    ASSY.stl
    {
        type triSurfaceMesh;
        name vehicle;

        regions
        {
            BW { name BW; }
            FLOOR { name FLOOR; }
            FW { name FW; }
            RW { name RW; }
            FLWh { name FLWh; }
            RLWh { name RLWh; }
            FRWh { name FRWh; }
            RRWh { name RRWh; }
        }
    }

    refinementBox
    {
        type searchableBox;
        min (-1 -0.6 0);
        max ( 4 0.6 1);
    }

};

// Settings for the castellatedMesh generation.
castellatedMeshControls
{

    // Refinement parameters
    maxLocalCells 100000;
    maxGlobalCells 2000000;
    minRefinementCells 10;	//0
    maxLoadUnbalance 0.10;
    nCellsBetweenLevels 2;	//3

    // Explicit feature edge refinement
    features
    (
        {
            file "ASSY.eMesh";
            level 0; // level 2
        }
    );

    // Surface based refinement

    refinementSurfaces
    {
        vehicle
        {
            level (1 1);

            regions
            {
                BW
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                FLOOR
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                FW
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                RW
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                FLWh
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                RLWh
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                FRWh
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
                RRWh
                {
                    level (2 2); // (2 4)
                    patchinfo { type wall; }
                }
            }
        }
    }

    resolveFeatureAngle 30;		//default
    planarAngle 30;			

    // Region-wise refinement

    refinementRegions
    {
/*
        refinementBox
        {
            mode inside;   
            levels ((1E15 1)); 
        }
*/
    }

    // Mesh selection

    locationInMesh (3 0 0.5)

    allowFreeStandingZoneFaces true;
}

// Settings for the snapping.
snapControls
{
    nSmoothPatch 		    3;
    tolerance 			    2.0;
    nSolveIter 			    300;		//30
    nRelaxIter 			    5;
    nFeatureSnapIter 		20;		//10;
    implicitFeatureSnap 	false;
    explicitFeatureSnap 	true;
    multiRegionFeatureSnap 	false;
}

// Settings for the layer addition.
addLayersControls
{
    relativeSizes true;

    // Layer thickness specification. This can be specified in one of following ways:
    // - expansionRatio and finalLayerThickness (cell nearest internal mesh)
    // - expansionRatio and firstLayerThickness (cell on surface)
    // - overall thickness and firstLayerThickness
    // - overall thickness and finalLayerThickness
    // - overall thickness and expansionRatio

    expansionRatio 		    1.2;
    finalLayerThickness 	0.3;
    //firstLayerThickness 	0.1;
    //thickness 		    0.6;
    //minThickness 		    0.25;
    minThickness 		    0.1; 	//0.001

    layers
    {
        BW
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        FLOOR
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        FW
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        RW
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        FLWh
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        RLWh
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        FRWh
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
        RRWh
        {
            nSurfaceLayers          3;
            //expansionRatio      1.2;
            //finalLayerThickness 0.5;		//with relative sizes true
            //minThickness        0.1;		//with relative sizes true
        }
    }
    nGrow 0;
    //featureAngle 0;		//no inflation
    //featureAngle 60;
    //featureAngle 130;		//default
    //featureAngle 270;
    featureAngle 330;		
    maxFaceThicknessRatio 0.5; 
    nSmoothSurfaceNormals 1;
    nSmoothThickness 10;
    minMedialAxisAngle 130;		//90;
    minMedianAxisAngle 130;		//90;
    maxThicknessToMedialRatio 0.3;     
    nSmoothNormals 10;		//3;
    //nMedialAxisIter  10;		//this deals with propagation of dislocations in corners
    //nSmoothDisplacement  90;
    //detectExtrusionIsland  true;
    slipFeatureAngle 30;
    nRelaxIter 10;			//5	//3
    nBufferCellsNoExtrude 0;
    nLayerIter 50;
    nRelaxedIter 20;
    additionalReporting true;
}

meshQualityControls
{
    #include "meshQualityDict"

    relaxed
    {
        maxNonOrtho 75; // Set to 180 to disable.
    }

    // Advanced
    nSmoothScale 4;
    errorReduction 0.75;
}

debugFlags
(
    //mesh            // write intermediate meshes
    //intersections   // write current mesh intersections as .obj files
    //featureSeeds    // write information about explicit feature edge refinement
    //attraction      // write attraction as .obj files
    //layerInfo       // write information about layers
);

writeFlags
(
    scalarLevels    // write volScalarField with cellLevel for postprocessing
    layerSets       // write cellSets, faceSets of faces in layer
    layerFields     // write volScalarField for layer coverage
);

// Merge tolerance. Is fraction of overall bounding box of initial mesh.
// Note: the write tolerance needs to be higher than this.
mergeTolerance 1e-6;

// ************************************************************************* //
